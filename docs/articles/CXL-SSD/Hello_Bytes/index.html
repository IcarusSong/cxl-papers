<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        Document
    </title>
    <link rel='stylesheet' href=../../../css/index.css />
    
    <link rel="icon" href="https://raw.githubusercontent.com/learner-lu/picbed/master/logo.png">
</head>

<body class="light">
    <a href="https://github.com/IcarusSong/cxl-papers.git" target="_blank" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <div class="header-navigator"><ul><li><a href="#h1-0">Hello bytes, bye blocks: PCIe storage meets compute express link for memory expansion</a><ul><li><a href="#h2-1">作者以及出版物</a><ul><li><a href="#h3-2">作者</a></li></ul><ul><li><a href="#h3-3">出版物</a></li></ul></li></ul><ul><li><a href="#h2-4">1. CXL技术的兴起与块存储的缺席</a></li></ul><ul><li><a href="#h2-5">2. 核心问题：块存储为何需要CXL？</a><ul><li><a href="#h3-6">(1) 块语义与内存语义的冲突</a></li></ul><ul><li><a href="#h3-7">(2) PCIe的非缓存访问限制</a></li></ul><ul><li><a href="#h3-8">(3) 缓存一致性的缺失</a></li></ul><ul><li><a href="#h3-9">(4) 存储资源池化的潜力</a></li></ul></li></ul><ul><li><a href="#h2-10">3. PCIe存储的困境：为何无法直接作为内存扩展器？</a><ul><li><a href="#h3-11">(1) 非缓存访问的性能代价</a></li></ul><ul><li><a href="#h3-12">(2) 块语义的兼容性挑战</a></li></ul><ul><li><a href="#h3-13">(3) 缺乏缓存一致性机制</a></li></ul></li></ul><ul><li><a href="#h2-14">4. CXL的革新：将PCIe存储集成到内存层次</a><ul><li><a href="#h3-15">(1) 设备类型选择：为何是Type 3？</a></li></ul><ul><li><a href="#h3-16">(2) 系统集成方案</a></li></ul><ul><li><a href="#h3-17">(3) 存储架构改造</a></li></ul></li></ul><ul><li><a href="#h2-18">5. 性能验证：CXL存储的潜力与局限</a><ul><li><a href="#h3-19">(1) 测试环境</a></li></ul><ul><li><a href="#h3-20">(2) 关键结果</a></li></ul></li></ul><ul><li><a href="#h2-21">6. 存储分离：构建可扩展的CXL网络</a><ul><li><a href="#h3-22">(1) 拓扑设计</a></li></ul><ul><li><a href="#h3-23">(2) 虚拟化与资源共享</a></li></ul></li></ul><ul><li><a href="#h2-24">7. 延迟优化：确定性（Determinism）与缓冲能力（Bufferability）</a><ul><li><a href="#h3-25">延迟波动（Latency Fluctuation）</a></li></ul><ul><li><a href="#h3-26">数据持久性（Data Persistence）</a></li></ul><ul><li><a href="#h3-27">(1) 确定性（DT/ND）</a></li></ul><ul><li><a href="#h3-28">(2) 缓冲能力（BF/NB）</a></li></ul><ul><li><a href="#h3-29">(3) 组合策略示例</a></li></ul></li></ul><ul><li><a href="#h2-30">8. 总结与展望</a><ul><li><a href="#h3-31">(1) 核心贡献</a></li></ul><ul><li><a href="#h3-32">(2) 未来方向</a></li></ul><ul><li><a href="#h3-33">(3) 产业意义</a></li></ul></li></ul></li></ul></div><div class='markdown-body'><h1 id="h1-0">Hello bytes, bye blocks: PCIe storage meets compute express link for memory expansion</h1><h2 id="h2-1">作者以及出版物</h2><h3 id="h3-2">作者</h3><p>Myoungsoo Jung， <b>KAIST</b></p><h3 id="h3-3">出版物</h3><p>HotStorage ’22</p><h2 id="h2-4"><b>1. CXL技术的兴起与块存储的缺席</b></h2><p><b>背景</b> Compute Express Link（CXL）作为一种开放、缓存一致的互连协议，自诞生以来被视为异构计算系统的革命性技术。它通过整合CPU、加速器和内存设备，构建统一的缓存一致性内存空间，尤其擅长内存池化（Memory Pooling）。然而，CXL最初的设计主要面向DRAM和持久内存（PMEM），<b>未将块存储设备（如SSD）纳入其核心支持范围</b>。这一局限性引发关键问题：</p><ul><li><b>块存储能否通过CXL实现内存级性能？</b></li></ul><ul><li><b>如何将块语义（Block Semantics）转换为字节语义（Byte Semantics）？</b></li></ul><h2 id="h2-5"><b>2. 核心问题：块存储为何需要CXL？</b></h2><p>论文提出四个关键问题，直指传统PCIe存储的痛点：</p><h3 id="h3-6"><b>(1) 块语义与内存语义的冲突</b></h3><ul><li><b>块存储的固有缺陷</b>：传统SSD通过NVMe协议以块（通常4KB）为单位读写数据，与CPU的字节寻址模式不兼容。</li></ul><ul><li><b>内存扩展需求</b>：新兴应用（如大规模图计算、AI训练）需TB级内存，而DRAM成本高昂，亟需低成本扩展方案。</li></ul><h3 id="h3-7"><b>(2) PCIe的非缓存访问限制</b></h3><ul><li><b>性能瓶颈</b>：PCIe存储通过内存映射I/O（MMIO）暴露地址空间，但CPU无法缓存此类请求，导致每次访问需直接穿透PCIe总线，延迟高且带宽利用率低。</li></ul><ul><li><b>示例</b>：PCIe Gen5 x16的理论带宽为64GB/s，但因非缓存访问，实际有效带宽可能不足50%。</li></ul><h3 id="h3-8"><b>(3) 缓存一致性的缺失</b></h3><ul><li><b>多设备协同难题</b>：传统PCIe设备无法参与CPU缓存一致性协议，导致多主机或加速器共享存储时需复杂同步机制。</li></ul><h3 id="h3-9"><b>(4) 存储资源池化的潜力</b></h3><ul><li><b>目标</b>：通过CXL将分布式SSD聚合成全局内存池，支持细粒度分配与低延迟访问。</li></ul><h2 id="h2-10"><b>3. PCIe存储的困境：为何无法直接作为内存扩展器？</b></h2><p>尽管PCIe存储具备大容量和低成本优势，其作为内存扩展器存在根本性缺陷：</p><h3 id="h3-11"><b>(1) 非缓存访问的性能代价</b></h3><ul><li><b>强制同步访问</b>：CPU对PCIe BAR（Base Address Register）的访问需绕过缓存，导致频繁的PCIe事务和更高的延迟。</li></ul><ul><li><b>对比实验</b>：在相同工作负载下，PCIe存储的访问延迟是本地DRAM的10倍以上（见论文§5）。</li></ul><h3 id="h3-12"><b>(2) 块语义的兼容性挑战</b></h3><ul><li><b>粒度不匹配</b>：内存操作以缓存行（通常64B）为单位，而SSD的最小读写单元为4KB，造成读写放大。</li></ul><ul><li><b>地址转换开销</b>：需额外FTL（Flash Translation Layer）将字节地址映射为物理块，增加延迟。</li></ul><h3 id="h3-13"><b>(3) 缺乏缓存一致性机制</b></h3><ul><li><b>多设备竞争</b>：若多个CPU核或加速器并发访问同一PCIe存储区域，需软件维护一致性，复杂度高且易出错。</li></ul><h2 id="h2-14"><b>4. CXL的革新：将PCIe存储集成到内存层次</b></h2><h3 id="h3-15"><b>(1) 设备类型选择：为何是Type 3？</b></h3><p>CXL定义三种设备类型（Type 1~3），论文主张将PCIe存储作为<b>Type 3设备</b>，原因包括：</p><ul><li><b>协议简化</b>：仅需支持CXL.mem（内存读写）和CXL.io（设备管理），无需复杂的CXL.cache（缓存一致性）。</li></ul><ul><li><b>扩展性优势</b>：Type 3支持多设备级联，而Type 2因缓存一致性限制仅支持单设备连接。</li></ul><ul><li><b>硬件改造成本低</b>：复用现有NVMe控制器逻辑，仅需新增CXL协议解析模块。</li></ul><h3 id="h3-16"><b>(2) 系统集成方案</b></h3><p><a data-lightbox="example-1" href="https://pic1.imgdb.cn/item/67fd018488c538a9b5d0e068.png"><img loading="lazy" src="https://pic1.imgdb.cn/item/67fd018488c538a9b5d0e068.png" alt=""></a></p><ul><li><b>内存映射</b>：通过CXL Root Port（RP）将SSD的HDM（Host-Managed Device Memory）映射到主机物理地址空间，实现字节寻址。<ul><li>内存映射过程：</li></ul><ul><li>步骤1：主机启动时，枚举连接到CXL RP的CXL设备，并初始化这些设备。主机将设备的内存空间（HDM和BAR）映射到系统内存中。</li></ul><ul><li>步骤2：CXL RP在系统内存中预留了一部分空间用于CXL设备的内存映射。HDM被映射到可缓存的内存地址空间，这样用户可以通过加载/存储指令访问它。BAR也被映射到系统内存中，用于设备的配置和控制。</li></ul><ul><li>步骤3：当应用程序访问映射到HDM的内存时，CXL RP会生成CXL flit（一种CXL消息），并通过CXL.mem发送到目标CXL存储控制器。CXL控制器解析flit并提取请求信息，然后与设备固件协作来处理请求。设备固件管理设备的内部操作，如数据读写和缓存管理。</li></ul></li></ul><ul><li><b>访问流程</b>：<ol start="1"><li>主机通过load/store指令访问CXL内存区域。</li></ol><ol start="2"><li>CXL RP生成CXL Flit（协议数据单元），经PCIe物理层传输至存储设备。</li></ol><ol start="3"><li>SSD内部CXL控制器解析请求，从DRAM缓存或后端介质返回数据。</li></ol></li></ul><h3 id="h3-17"><b>(3) 存储架构改造</b></h3><ul><li><b>DRAM缓存优化</b>：SSD内部DRAM作为写回缓存，结合预取算法隐藏后端介质延迟。</li></ul><ul><li><b>FTL协同设计</b>：将FTL地址转换逻辑卸载至CXL控制器，减少主机CPU开销。</li></ul><h2 id="h2-18"><b>5. 性能验证：CXL存储的潜力与局限</b></h2><h3 id="h3-19"><b>(1) 测试环境</b></h3><ul><li><b>硬件原型</b>：基于FPGA模拟CXL主机与OpenExpress SSD（模拟Z-NAND介质）。</li></ul><ul><li><b>对比方案</b>：本地DRAM、传统PCIe存储、CXL扩展存储。</li></ul><h3 id="h3-20"><b>(2) 关键结果</b></h3><p><a data-lightbox="example-1" href="https://pic1.imgdb.cn/item/67fd01bd88c538a9b5d0e086.png"><img loading="lazy" src="https://pic1.imgdb.cn/item/67fd01bd88c538a9b5d0e086.png" alt=""></a></p><ul><li><b>高局部性场景（α=0.001）</b>：CXL存储延迟接近DRAM（1.73 vs. 1.0周期），因缓存命中率高。</li></ul><ul><li><b>随机访问场景（α=1）</b>：CXL延迟达344.9周期，显著高于DRAM（4.1周期），反映后端介质延迟的影响。</li></ul><ul><li><b>结论</b>：CXL存储适用于局部性较强的负载，但需优化尾部延迟。</li></ul><h2 id="h2-21"><b>6. 存储分离：构建可扩展的CXL网络</b></h2><p><a data-lightbox="example-1" href="https://pic1.imgdb.cn/item/67fd01d288c538a9b5d0e088.png"><img loading="lazy" src="https://pic1.imgdb.cn/item/67fd01d288c538a9b5d0e088.png" alt=""></a></p><h3 id="h3-22"><b>(1) 拓扑设计</b></h3><ul><li><b>单交换机架构</b>：通过CXL Switch连接多个SSD，支持主机动态映射存储资源。</li></ul><ul><li><b>多级交换机网络</b>：扩展至树状结构，支持数百个SSD设备池化。</li></ul><h3 id="h3-23"><b>(2) 虚拟化与资源共享</b></h3><ul><li><b>MLD（Multiple Logical Device）</b>：将单个物理SSD虚拟化为多个逻辑设备，分别映射到不同主机的内存空间。</li></ul><ul><li><b>优势</b>：支持多租户隔离、资源按需分配，避免存储带宽争用。</li></ul><h2 id="h2-24"><b>7. 延迟优化：确定性（Determinism）与缓冲能力（Bufferability）</b></h2><h3 id="h3-25">延迟波动（Latency Fluctuation）</h3><p>CXL Type 3设备设计初衷是内存池化，而非块存储。当PCIe存储作为CXL内存扩展时，其内部任务（如垃圾回收、FTL映射更新）可能导致响应时间不可预测，影响主机性能。</p><h3 id="h3-26">数据持久性（Data Persistence）</h3><p>现有CXL通过全局持久刷新（GPF）机制强制将数据写回存储介质，但GPF会导致大规模DRAM缓冲数据同时刷写，引发显著延迟。</p><p>为了解决上面两个延迟问题，本文提出了两个特性：确定性和缓冲性。这些特性可以标注在CXL消息上，并向底层CXL控制器提示主机语义。CXL允许Type 3管理CXL.io以满足各种特定的I/O需求，CXL.mem也有一个保留字段，可用于标注。</p><h3 id="h3-27"><b>(1) 确定性（DT/ND）</b></h3><ul><li><b>DT（Deterministic）</b>：要求存储设备立即处理请求，绕过垃圾回收等后台任务。<ul><li><b>用例</b>：事务提交、锁同步等低延迟敏感操作。</li></ul></li></ul><ul><li><b>ND（Non-Deterministic）</b>：允许请求异步处理，存储设备在空闲时段执行内部任务。<ul><li><b>用例</b>：日志写入、数据预取等后台任务。</li></ul></li></ul><h3 id="h3-28"><b>(2) 缓冲能力（BF/NB）</b></h3><ul><li><b>BF（Bufferable）</b>：数据暂存于SSD DRAM，延迟写回介质。<ul><li><b>用例</b>：临时数据、高局部性负载。</li></ul></li></ul><ul><li><b>NB（Non-Bufferable）</b>：强制数据持久化到存储介质。<ul><li><b>用例</b>：关键元数据、事务提交。</li></ul></li></ul><h3 id="h3-29"><b>(3) 组合策略示例</b></h3><ul><li><b>数据库事务</b>：<ul><li>日志写入：BF+ND（缓冲日志，异步持久化）。</li></ul><ul><li>事务提交：NB+DT（立即持久化，绕过内部任务）。</li></ul></li></ul><ul><li><b>科学计算</b>：<ul><li>中间结果：BF+ND（利用DRAM加速迭代计算）。</li></ul><ul><li>检查点保存：NB+ND（异步但确保持久化）。</li></ul></li></ul><h2 id="h2-30"><b>8. 总结与展望</b></h2><h3 id="h3-31"><b>(1) 核心贡献</b></h3><ul><li><b>理论突破</b>：证明CXL可通过Type 3设备将块存储转换为字节可寻址内存。</li></ul><ul><li><b>实践验证</b>：通过原型系统验证CXL存储的可行性，揭示性能边界。</li></ul><ul><li><b>协议扩展</b>：提出Determinism与Bufferability，为CXL存储优化提供新范式。</li></ul><h3 id="h3-32"><b>(2) 未来方向</b></h3><ul><li><b>硬件自动化</b>：在SSD控制器中集成CXL协议硬核，减少FPGA原型开销。</li></ul><ul><li><b>软件生态</b>：开发CXL存储管理工具链（如内存分配器、持久化库）。</li></ul><ul><li><b>网络优化</b>：研究CXL交换机拥塞控制算法，提升多设备并发访问效率。</li></ul><h3 id="h3-33"><b>(3) 产业意义</b></h3><p>CXL存储扩展技术有望推动“内存-存储”层级融合，为AI、大数据等场景提供低成本、高容量的内存解决方案，同时为下一代存储架构（如存算一体）奠定基础。</p></div>
    <div class="dir-tree"><ul><li><a href="../../md-docs/README" >README</a></li></ul><ul><li><a href="../../内存池化/Pond" >内存池化</a><ul><li><a href="../../内存池化/Pond" >Pond</a></li></ul><ul><li><a href="../../内存池化/Direct_CXL" >Direct_CXL</a></li></ul><ul><li><a href="../../内存池化/Against_CXL_Memory_Pooling" >Against_CXL_Memory_Pooling</a></li></ul><ul><li><a href="../../内存池化/Logical Memory Pools:  Flexible and Local Disaggregated Memory" >Logical Memory Pools:  Flexible and Local Disaggregated Memory</a></li></ul><ul><li><a href="../../内存池化/STARNUMA: Mitigating NUMA Challenges with Memory Pooling" >STARNUMA: Mitigating NUMA Challenges with Memory Pooling</a></li></ul><ul><li><a href="../../内存池化/Performance Evaluation on CXL-enabled Hybrid  Memory Pool" >Performance Evaluation on CXL-enabled Hybrid  Memory Pool</a></li></ul><ul><li><a href="../../内存池化/Memory Sharing with CXL: Hardware and Software Design Approaches" >Memory Sharing with CXL: Hardware and Software Design Approaches</a></li></ul></li></ul><ul><li><a href="../../内存分级/TPP" >内存分级</a><ul><li><a href="../../内存分级/TPP" >TPP</a></li></ul><ul><li><a href="../../内存分级/NeoMem" >NeoMem</a></li></ul></li></ul><ul><li><a href="../../带宽与延迟/Demystifying_CXL_Memory_with_Genuine_CXL-Ready_Systems_and_Devices" >带宽与延迟</a><ul><li><a href="../../带宽与延迟/Demystifying_CXL_Memory_with_Genuine_CXL-Ready_Systems_and_Devices" >Demystifying_CXL_Memory_with_Genuine_CXL-Ready_Systems_and_Devices</a></li></ul><ul><li><a href="../../带宽与延迟/Systematic CXL Memory Characterization and  Performance Analysis at Scale" >Systematic CXL Memory Characterization and  Performance Analysis at Scale</a></li></ul></li></ul><ul><li><a href="../../CXL-SSD/Hello_Bytes" >CXL-SSD</a><ul><li><a href="../../CXL-SSD/Hello_Bytes" >Hello_Bytes</a></li></ul><ul><li><a href="../../CXL-SSD/Cache_in_Hand" >Cache_in_Hand</a></li></ul></li></ul><ul><li><a href="../../simulation/CXL-DMsim" >simulation</a><ul><li><a href="../../simulation/CXL-DMsim" >CXL-DMsim</a></li></ul></li></ul><ul><li><a href="../../CXL探索/Enhanced_Memory_Functions" >CXL探索</a><ul><li><a href="../../CXL探索/Enhanced_Memory_Functions" >Enhanced_Memory_Functions</a></li></ul></li></ul><ul><li><a href="../../内存拓展/Breaking_Barriers:Expanding_GPU_Memory_with_Sub-Two_Digit_Nanosecond_Latency_CXL_Controller" >内存拓展</a><ul><li><a href="../../内存拓展/Breaking_Barriers:Expanding_GPU_Memory_with_Sub-Two_Digit_Nanosecond_Latency_CXL_Controller" >Breaking_Barriers:Expanding_GPU_Memory_with_Sub-Two_Digit_Nanosecond_Latency_CXL_Controller</a></li></ul><ul><li><a href="../../内存拓展/Accelerating_Performance_of_GPU-based_Workloads_Using_CXL" >Accelerating_Performance_of_GPU-based_Workloads_Using_CXL</a></li></ul></li></ul><ul><li><a href="../../Prefetch/Polaris: Enhancing CXL-based Memory Expanders with Memory-side Prefetching" >Prefetch</a><ul><li><a href="../../Prefetch/Polaris: Enhancing CXL-based Memory Expanders with Memory-side Prefetching" >Polaris: Enhancing CXL-based Memory Expanders with Memory-side Prefetching</a></li></ul></li></ul></div>
    <div class="zood"><a class="" href="https://github.com/luzhixing12345/zood" target="_blank">zood</a></div>
    <script type="text/javascript" src="../../../js/next_front.js"></script><script>addLink("../../带宽与延迟/Systematic CXL Memory Characterization and  Performance Analysis at Scale","../../CXL-SSD/Cache_in_Hand","ab");</script><script type="text/javascript" src="../../../js/change_mode.js"></script><script>addChangeModeButton("../../../img/sun.png","../../../img/moon.png");</script><script type="text/javascript" src="../../../js/copy_code.js"></script><script>addCodeCopy("../../../img/clipboard.svg","../../../img/clipboard-check.svg");</script><script type="text/javascript" src="../../../js/navigator.js"></script><script type="text/javascript" src="../../../js/picture_preview.js"></script><script type="text/javascript" src="../../../js/global_js_configuration.js"></script>
</body>

</html>